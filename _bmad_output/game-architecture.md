# Architecture

## Executive Summary

**Funky Flappy** is a high-fidelity Action Platformer evolving the classic Flappy Bird formula with elemental strategy and premium visuals. The project uses **Godot 4.5** with **GDScript** to achieve a lightweight, performant WebGL build.

The architecture follows a **Node-based Composition** pattern typical of Godot. Core systems (Game, Audio) use **Autoloads (Singletons)** for global access. The game leverages Godot's **Signals** for decoupled event handling and **Resources** for data management (Bird stats, Skins).

## Decision Summary

| Category | Decision | Version | Affects Epics | Rationale |
| -------- | -------- | ------- | ------------- | --------- |
| **Engine** | Godot | 4.5 | All | Lightweight WebGL export, dedicated 2D engine. |
| **Language** | GDScript | 2.0 | All | Native integration, fast iteration, ideal for 2D. |
| **Input** | InputMap | N/A | Core Engine | Built-in action mapping for Keyboard/Touch. |
| **Architecture** | Autoloads + Signals | N/A | Core Engine | Godot standard for global state and event decoupling. |
| **Persistence** | ConfigFile / JSON | N/A | UI & Progression | Simple text-based saving for user data. |
| **Asset Mgmt** | `uid://` (ResourceLoader) | N/A | All | Godot's built-in resource system. |
| **Physics** | CharacterBody2D | N/A | Core Engine | Precise control over movement (vs RigidBody2D). |

## Project Structure

```
res://
├── assets/                 # Raw assets (sprites, audio)
│   ├── sprites/
│   ├── audio/
│   └── fonts/
├── src/                    # Source code and scenes
│   ├── core/               # Autoloads (GameManager, SoundManager)
│   ├── actors/             # Player, Enemies (Bird, FirePipe)
│   ├── objects/            # Interactive objects (Pipes, Coins, Projectiles)
│   ├── levels/             # Main Game, Menu scenes
│   ├── ui/                 # HUD, Menus
│   └── data/               # Resource scripts (BirdData.gd)
└── exports/                # Export presets/builds
```

## Epic to Architecture Mapping

| Epic | Architecture Components |
| :--- | :--- |
| **1. Core Engine** | `GameManager` (Autoload), `Bird` (CharacterBody2D) |
| **2. Environment** | `PipeSpawner`, `ParallaxBackground`, `DayNightCycle` |
| **3. Elemental** | `IceProjectile` (Area2D), `FirePipe` (Area2D) |
| **4. UI & Progression** | `SaveSystem`, `ShopMenu`, `HUD` |
| **5. Polish & Audio** | `SoundManager` (Autoload), `GPUParticles2D` |

## Technology Stack Details

### Core Technologies
-   **Engine**: Godot 4.5
-   **Language**: GDScript
-   **Renderer**: Compatibility (OpenGL ES 3.0) for best Web support, or Forward+ if WebGL 2.0 strictly targeted.

### Integration Points
-   **GameManager**: Autoload. Manages State (Playing, GameOver), Score, and Scene transitions.
-   **SignalBus**: (Optional) Autoload for global events if GameManager gets too crowded.

## Novel Pattern Designs

### Elemental Interaction System
**Pattern**: `Groups` & `Area2D`
-   **Fire Pipes**: Added to group "fire_hazard".
-   **Ice Projectile**: On `area_entered(area)`:
    -   If `area.is_in_group("fire_hazard")`: Call `area.extinguish()`.

## Implementation Patterns

### Naming Conventions
-   **Folders/Files**: `snake_case` (e.g., `bird_controller.gd`, `main_menu.tscn`)
-   **Classes**: `PascalCase` (e.g., `class_name Bird`)
-   **Variables/Functions**: `snake_case` (e.g., `var move_speed`, `func _on_ready()`)
-   **Constants**: `UPPER_CASE` (e.g., `MAX_SPEED`)

### Code Organization
-   **Strong Typing**: Use static typing where possible (e.g., `var score: int = 0`).
-   **Signal Connections**: Connect signals in code (`_ready()`) rather than Editor for better traceability, or use clear naming `_on_button_pressed`.

## Data Architecture

### PlayerData (JSON/Dictionary)
```gdscript
{
  "high_score": 150,
  "coins": 500,
  "unlocked_birds": ["classic", "neon"],
  "current_bird": "neon"
}
```

## Development Environment

### Prerequisites
-   Godot 4.5 Executable
-   VS Code (with Godot Tools) or Built-in Editor

### Setup Commands
```bash
# Create project.godot
# Open in Godot Editor
```

## Architecture Decision Records (ADRs)

### ADR-001: CharacterBody2D vs RigidBody2D
-   **Decision**: `CharacterBody2D`.
-   **Rationale**: Flappy Bird physics are simple but specific. `CharacterBody2D` gives precise control over velocity and collision response without fighting the physics engine.

### ADR-002: Autoloads for Managers
-   **Decision**: Use Autoloads for `GameManager` and `SoundManager`.
-   **Rationale**: Simplest way to persist state across scene reloads (Main Menu -> Game).

---

_Generated by BMAD Decision Architecture Workflow v1.0_
_Date: 2025-12-25_
_For: Anshuman_
